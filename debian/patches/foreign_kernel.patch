Author: Samuel Mimram <smimram@debian.org>
Description: Use provided kernel version.
--- a/module/Makefile
+++ b/module/Makefile
@@ -9,7 +9,8 @@
 endif
 
 MODULE    := sysprof-module
-KDIR      := /lib/modules/$(shell uname -r)/build
+KVERS     := $(shell uname -r)
+KDIR      := /lib/modules/$(KVERS)/build
 INCLUDE   := -isystem $(KDIR)/include
 MODCFLAGS := -DMODULE -D__KERNEL__ -Wall ${INCLUDE}
 
@@ -21,7 +22,7 @@
 	modprobe -r sysprof-module
 	modprobe sysprof-module
 
-ifneq ($(shell (uname -r | grep 2.6) > /dev/null ; echo -n $$?),0)
+ifneq ($(shell ($(KVERS) | grep 2.6) > /dev/null ; echo -n $$?),0)
 	echo A 2.6 kernel is required; exit 1
 endif
 
