#!/usr/bin/make -f
# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh  $@

# Use override_dh_* targets to customize this.
# ---------------------------------------------------
# Followings are the old debian/rules
#
# #!/usr/bin/make -f
# # -*- makefile -*-
# # Sample debian/rules that uses debhelper.
# # This file was originally written by Joey Hess and Craig Small.
# # As a special exception, when this file is copied by dh-make into a
# # dh-make output file, you may use that output file without restriction.
# # This special exception was added by Craig Small in version 0.37 of dh-make.
# 
# # Uncomment this to turn on verbose mode.
# #export DH_VERBOSE=1
# 
# # This has to be exported to make some magic below work.
# export DH_OPTIONS
# export KSRC
# export KVERS
# export KDREV
# 
# # We want to use dpatch
# include /usr/share/dpatch/dpatch.make
# 
# DESTDIR = $(CURDIR)/debian/tmp
# SYSPROFDIR = $(CURDIR)/debian/sysprof
# 
# # These are used for cross-compiling and for saving the configure script
# # from having to guess our platform (since we know it already)
# DEB_HOST_GNU_TYPE   ?= $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
# DEB_BUILD_GNU_TYPE  ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
# 
# ifeq ($(DEB_BUILD_GNU_TYPE), $(DEB_HOST_GNU_TYPE))
#   confflags += --build $(DEB_HOST_GNU_TYPE)
# else
#   confflags += --build $(DEB_BUILD_GNU_TYPE) --host $(DEB_HOST_GNU_TYPE)
# endif
# 
# CFLAGS = -Wall -g
# 
# ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
# 	CFLAGS += -O0
# else
# 	CFLAGS += -O2
# endif
# 
# config.status: configure
# 	dh_testdir
# #	CFLAGS="$(CFLAGS) -Wl,-z,defs"
# 	CFLAGS="$(CFLAGS)" ./configure $(confflags) --prefix=/usr --mandir=\$${prefix}/share/man --infodir=\$${prefix}/share/info --disable-kernel-module
# 
# build: patch-stamp build-stamp
# build-stamp:  config.status
# 	dh_testdir
# 	$(MAKE) all
# 	touch build-stamp
# 
# clean: unpatch
# 	dh_testdir
# 	dh_testroot
# 	rm -f build-stamp
# 	[ ! -f Makefile ] || $(MAKE) distclean
# 	rm -f config.log
# 	dh_clean
# 
override_dh_install:
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	# Install sysprof.
	make install DESTDIR=$(SYSPROFDIR)
	cp debian/sysprof.xpm $(SYSPROFDIR)/usr/share/pixmaps
	mkdir -p $(SYSPROFDIR)/usr/share/applications
	cp debian/sysprof.desktop $(SYSPROFDIR)/usr/share/applications

	# Install the sources of the kernel module.
	install -D -m 0755 debian/rules.modules debian/tmp/modules/sysprof-module/debian/rules
	for f in debian/*.modules.in debian/control debian/compat debian/copyright debian/changelog; do \
		install -m 0644 $$f debian/tmp/modules/sysprof-module/debian/; \
	done
	cp module/* debian/tmp/modules/sysprof-module/
	cd debian/tmp/; tar jcvf ../sysprof-module-source/usr/src/sysprof-module.tar.bz2 modules
	rm -rf debian/tmp/modules

# install: build
# 	dh_testdir
# 	dh_testroot
# 	dh_clean -k
# 	dh_installdirs
# 
# 	# Install sysprof.
# 	make install DESTDIR=$(SYSPROFDIR)
# 	cp debian/sysprof.xpm $(SYSPROFDIR)/usr/share/pixmaps
# 	mkdir -p $(SYSPROFDIR)/usr/share/applications
# 	cp debian/sysprof.desktop $(SYSPROFDIR)/usr/share/applications
# 
# 	# Install the sources of the kernel module.
# 	install -D -m 0755 debian/rules.modules debian/tmp/modules/sysprof-module/debian/rules
# 	for f in debian/*.modules.in debian/control debian/compat debian/copyright debian/changelog; do \
# 		install -m 0644 $$f debian/tmp/modules/sysprof-module/debian/; \
# 	done
# 	cp module/* debian/tmp/modules/sysprof-module/
# 	cd debian/tmp/; tar jcvf ../sysprof-module-source/usr/src/sysprof-module.tar.bz2 modules
# 	rm -rf debian/tmp/modules
# 
# # Build architecture-independent files here.
# binary-indep: build install
# # We have nothing to do by default.
# 
# # Build architecture-dependent files here.
# binary-arch: build install
# 	dh_testdir
# 	dh_testroot
# 	dh_installchangelogs ChangeLog
# 	dh_installdocs
# 	dh_installexamples
# 	dh_install --sourcedir=debian/tmp --list-missing
# 	dh_installmenu
# 	dh_installman debian/sysprof.1
# 	dh_link
# 	dh_strip
# 	dh_compress
# 	dh_fixperms
# 	dh_makeshlibs
# 	dh_installdeb
# 	dh_shlibdeps
# 	dh_gencontrol
# 	dh_md5sums
# 	dh_builddeb
# 
# binary: binary-indep binary-arch
# .PHONY: build clean binary-indep binary-arch binary install
